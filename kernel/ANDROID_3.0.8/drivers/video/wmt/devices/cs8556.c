/*++ 
 * linux/drivers/video/wmt/cs8556.c
 * WonderMedia video post processor (VPP) driver
 *
 * Copyright c 2012  WonderMedia  Technologies, Inc.
 *
 * This program is free software: you can redistribute it and/or modify 
 * it under the terms of the GNU General Public License as published by 
 * the Free Software Foundation, either version 2 of the License, or 
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful, 
 * but WITHOUT ANY WARRANTY; without even the implied warranty of 
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the 
 * GNU General Public License for more details. 
 *
 * You should have received a copy of the GNU General Public License 
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * WonderMedia Technologies, Inc.
 * 4F, 533, Chung-Cheng Road, Hsin-Tien, Taipei 231, R.O.C
--*/

#define CS8556_C
#define DEBUG
#define DEBUG_DETAIL

/*----------------------- DEPENDENCE -----------------------------------------*/
#include "../vout.h"

#ifdef CONFIG_KERNEL
#include "../../../i2c/chips/wmt-i2c-api.h"
#else
#include "../vpp.h"
#endif


#ifdef CONFIG_KERNEL
typedef unsigned char uchar;
#endif

int cs8556_isEnable(void);

/*----------------------- PRIVATE MACRO --------------------------------------*/
/* #define  CS8556_XXXX  xxxx    *//*Example*/

/*----------------------- PRIVATE CONSTANTS ----------------------------------*/
/* #define CS8556_XXXX    1     *//*Example*/
#define CS8556_ADDR (0x7A >> 1)

/*----------------------- PRIVATE TYPE  --------------------------------------*/
/* typedef  xxxx cs8556_xxx_t; *//*Example*/

/*----------EXPORTED PRIVATE VARIABLES are defined in cs8556.h  -------------*/
/*----------------------- INTERNAL PRIVATE VARIABLES - -----------------------*/
/* int  cs8556_xxx;        *//*Example*/
static int cs8556_not_ready;

/*--------------------- INTERNAL PRIVATE FUNCTIONS ---------------------------*/
/* void cs8556_xxx(void); *//*Example*/

static int encoder_table_size = 256;

/*--------------------- Register Table ---------------------------*/

static char	vga_byte0[] = {
  0x0E,0x80,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x02,0x02,0x01,0x00,0x00,0x00,
  0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0xB3,0x06,0x7F,0x00,0x00,0x01,0xA4,0x06,0x9C,0xE3,0x01,0x0A,0x00,0x00,0x00,0x00,
  0x0C,0x02,0x02,0x00,0x12,0x00,0x04,0x01,0x00,0x00,0x00,0x01,0x78,0x01,0x37,0x00,
  0x22,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x19,0x01,
  0x59,0x03,0x30,0x00,0x60,0x00,0xE0,0x02,0x00,0x00,0x00,0x10,0xC5,0x00,0xF1,0x01,
  0x0C,0x02,0x02,0x00,0x10,0x00,0xF0,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x22,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x80,0x01,0x10,0x0D,0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0xFF,0xFF,0x00,0x00,0xFF,0xFF,0x00,0x00,0x80,0x80,0x00,0x00,0x80,0x80,0x00,0x00,
  0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x00,
  0xFF,0x00,0xFF,0x00,0xFF,0x00,0xFF,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x01,0x01,0x03,0x00,0x01,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x60,0x00,0xE0,0x02,0x10,0x00,0xF0,0x01,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00};


static char	vga_byte1[] = {
  0x80,0x10,0x80,0x00,0x00,0x00,0x99,0x11,0x2A,0x00,0x70,0x30,0x2A,0x71,0x9C,0x00,
  0x10,0x2A,0x05,0x82,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0xFF,0x00,0x00,0x00,
  0x21,0x01,0x98,0x08,0xCC,0x00,0x4C,0x08,0x00,0x00,0x00,0x00,0x40,0x00,0x20,0x00,
  0x00,0x01,0xEE,0x02,0x3A,0x07,0x65,0x04,0x14,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x06,0x40,0x07,0x30,0x15,0x10,0x31,0x02,0x33,0x12,0x34,0x52,0x38,0x42,0x39,0x62,
  0x48,0x12,0x64,0x04,0x66,0x14,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x10,
  0x7E,0x10,0x00,0xF4,0x10,0x76,0x08,0x00,0x8A,0x00,0xA0,0x11,0xA0,0xA0,0x81,0x00,
  0x03,0x00,0x89,0x45,0x01,0x45,0x00,0x00,0x03,0x00,0x00,0x10,0x00,0x00,0x00,0x00,
  0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};


/* 
 * CS8556 AV Output - PAL Mode.
 * 720 x 576.
 */
static char	pal_byte0[] = {
  0x01, 0x80, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00,
  0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x5F, 0x03, 0x40, 0x00, 0x84, 0x00, 0x54, 0x03, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x00,
  0x70, 0x02, 0x05, 0x00, 0x2C, 0x00, 0x6C, 0x02, 0x00, 0x00, 0x84, 0x00, 0x2C, 0x00, 0x57, 0x00,
  0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xBF, 0x06, 0x7F, 0x00, 0xFE, 0x00, 0xA4, 0x06, 0x00, 0x00, 0x05, 0x10, 0x8E, 0x00, 0x37, 0x01,
  0x70, 0x02, 0x02, 0x00, 0x16, 0x00, 0x36, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x04, 0x01, 0x10, 0x0D, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00,
  0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00,
  0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x01, 0x03, 0x00, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x85, 0x4B, 0x01};


static char	pal_byte1[] = {
  0x80, 0x10, 0x80, 0x00, 0x00, 0x00, 0x99, 0x11, 0x2A, 0x00, 0x70, 0x30, 0x2A, 0x71, 0x9C, 0x00,
  0x10, 0x2A, 0x85, 0x82, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00,
  0x41, 0x01, 0x98, 0x08, 0xCC, 0x00, 0x4C, 0x08, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x40, 0x00,
  0x00, 0x01, 0xEE, 0x02, 0x3A, 0x07, 0x65, 0x04, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x06, 0x40, 0x07, 0x30, 0x15, 0x10, 0x31, 0x02, 0x33, 0x12, 0x34, 0x52, 0x38, 0x42, 0x39, 0x62,
  0x48, 0x12, 0x64, 0x04, 0x66, 0x14, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10,
  0x7E, 0x10, 0x00, 0xF4, 0x10, 0x76, 0x08, 0x00, 0x8A, 0x00, 0x4F, 0x11, 0x4F, 0x4F, 0x81, 0x00,
  0x03, 0x00, 0x89, 0x45, 0x01, 0x45, 0x00, 0x00, 0x03, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

/* 
 * CS8556 AV Output - PAL Mode.
 * 1280 x 720.
 */
static char	pal_720P_byte0[] = {
  0x0F, 0x80, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00, 0x02, 0x00, // crystal clock source
  0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xBB, 0x07, 0x27, 0x00, 0xAB, 0x00, 0x35, 0x06, 0x00, 0x80, 0x00, 0xD0, 0x00, 0x00, 0x00, 0x00, // Horizontal position
  0xED, 0x02, 0x04, 0x00, 0x18, 0x00, 0xE7, 0x02, 0x55, 0xD5, 0x1D, 0x01, 0x14, 0x00, 0x57, 0x00,
  0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xBF, 0x06, 0x7F, 0x00, 0x02, 0x01, 0xA4, 0x06, 0x00, 0x00, 0x45, 0x10, 0x70, 0x02, 0x34, 0x01,
  0x70, 0x02, 0x04, 0x00, 0x14, 0x00, 0x34, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x04, 0x01, 0x10, 0x0D, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00,
  0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00,
  0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x0A, 0x03, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x60, 0x00, 0xE0, 0x02, 0x10, 0x00, 0xF0, 0x01, 0xF0, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x1C, 0x01};


static char	pal_720P_byte1[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x45, 0x70, 0xC6, 0xF5, 0x07, 0x29, 0x51, 0x00, 0x10, 0xE9,
  0x77, 0xD2, 0x45, 0x00, 0xBB, 0x07, 0x45, 0x00, 0x00, 0x89, 0xBB, 0x07, 0x45, 0x00, 0x00, 0x00,
  0x20, 0x01, 0xBC, 0x07, 0x28, 0x01, 0x2B, 0x06, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x20, 0x00,
  0x78, 0x00, 0x3E, 0x03, 0x1C, 0x07, 0xEE, 0x02, 0x1A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x06, 0x20, 0x1A, 0x10, 0xEA, 0x02, 0xEF, 0x12, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10,
  0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10,
  0x7E, 0x10, 0x00, 0xF4, 0x10, 0x76, 0x08, 0x00, 0x8A, 0x00, 0xFF, 0x11, 0xFF, 0xFF, 0x81, 0x00,
  0x00, 0x00, 0x89, 0x45, 0x01, 0x45, 0x00, 0x00, 0x03, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

/* 
 * CS8556 AV Output - NTSC Mode.
 * 720 x 480.
 */
static char	ntsc_byte0[] = {
  0x01, 0x80, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00,
  0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x59, 0x03, 0x17, 0x00, 0x77, 0x00, 0xE0, 0x02, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x00, 0x00,
  0x0C, 0x02, 0x06, 0x00, 0x0F, 0x00, 0xEF, 0x01, 0x00, 0x00, 0x77, 0x00, 0x0F, 0x00, 0x77, 0x00,
  0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xB3, 0x06, 0x7F, 0x00, 0x04, 0x01, 0xA4, 0x06, 0x8F, 0xE3, 0x05, 0x10, 0x8E, 0x00, 0x0E, 0x01,
  0x0C, 0x02, 0x04, 0x00, 0x15, 0x00, 0x06, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x04, 0x01, 0x10, 0x0D, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00,
  0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00,
  0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x01, 0x03, 0x00, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x85, 0x1C, 0x01};


static char	ntsc_byte1[] = {
  0x80, 0x10, 0x80, 0x00, 0x00, 0x00, 0x99, 0x11, 0x2A, 0x00, 0x70, 0x30, 0x2A, 0x71, 0x9C, 0x00,
  0x10, 0x2A, 0x85, 0x82, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00,
  0x41, 0x01, 0x98, 0x08, 0xCC, 0x00, 0x4C, 0x08, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x40, 0x00,
  0x00, 0x01, 0xEE, 0x02, 0x3A, 0x07, 0x65, 0x04, 0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x06, 0x40, 0x07, 0x30, 0x15, 0x10, 0x31, 0x02, 0x33, 0x12, 0x34, 0x52, 0x38, 0x42, 0x39, 0x62,
  0x48, 0x12, 0x64, 0x04, 0x66, 0x14, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10,
  0x7E, 0x10, 0x00, 0xF4, 0x10, 0x76, 0x08, 0x00, 0x8A, 0x00, 0x4F, 0x11, 0x4F, 0x4F, 0x81, 0x00,
  0x03, 0x00, 0x89, 0x45, 0x01, 0x45, 0x00, 0x00, 0x03, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

/* 
 * CS8556 AV Output - NTSC Mode.
 * 1280 x 720.
 */
static char	ntsc_720P_byte0[] = {
 0x0F, 0x80, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x01, 0x00, 0x01, 0x00,
 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x71, 0x06, 0x27, 0x00, 0xC6, 0x00, 0x35, 0x06, 0x00, 0x82, 0x00, 0xD0, 0x00, 0x00, 0x00, 0x00,
 0xED, 0x02, 0x04, 0x00, 0x18, 0x00, 0xE7, 0x02, 0x00, 0xB3, 0x04, 0x01, 0x18, 0x00, 0x36, 0x00,
 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0xB3, 0x06, 0x4F, 0x00, 0x04, 0x01, 0xA4, 0x06, 0x00, 0x00, 0x05, 0x10, 0x70, 0x02, 0x00, 0x01,
 0x0C, 0x02, 0x04, 0x00, 0x15, 0x00, 0x06, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x04, 0x01, 0x10, 0x0D, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0xFF, 0xFF, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00,
 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00,
 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00, 0x80, 0x00,
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x01, 0x31, 0x5A, 0x00, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
 0x60, 0x00, 0xE0, 0x02, 0x10, 0x00, 0xF0, 0x01, 0xF0, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x1C, 0x01};

static char	ntsc_720P_byte1[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x45, 0x70, 0xC6, 0xF5, 0x07, 0x29, 0x51, 0x00, 0x10, 0xE9,
  0x77, 0xD2, 0x45, 0x00, 0xBB, 0x07, 0x45, 0x00, 0x00, 0x89, 0xBB, 0x07, 0x45, 0x00, 0x00, 0x00,
  0x22, 0x01, 0x71, 0x06, 0x28, 0x01, 0x2B, 0x06, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x20, 0x00,
  0x78, 0x00, 0x99, 0x02, 0xD2, 0x05, 0xEE, 0x02, 0x1A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x06, 0x20, 0x1A, 0x10, 0xED, 0x02, 0xEF, 0x12, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10,
  0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10, 0x00, 0x10,
  0x7E, 0x10, 0x00, 0xF4, 0x10, 0x76, 0x08, 0x00, 0x8A, 0x00, 0xFF, 0x11, 0xFF, 0xFF, 0x81, 0x00,
  0x00, 0x00, 0x89, 0x45, 0x01, 0x45, 0x00, 0x00, 0x03, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
  0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

// ======================== Fake EDID Tables ===========================

static int edid_table_size = 128;

/* 
 * CS8556 AV Output - Fake EDID.
 * cvbs-480i-4x3
 */
static char fake_edid_480i_4x3[] = {
  0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x59, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
, 0x00, 0x16, 0x01, 0x03, 0x80, 0x1F, 0x11, 0x78, 0x0A, 0x10, 0xB5, 0x97, 0x58, 0x57, 0x92, 0x26
, 0x1E, 0x50, 0x54, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01
, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x8C, 0x0A, 0xA0, 0x14, 0x51, 0xF0, 0x16, 0x00, 0x26, 0x7C
, 0x43, 0x00, 0x13, 0x8E, 0x21, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00
, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xFE, 0x00, 0x56
, 0x49, 0x41, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x00, 0x00, 0x00, 0xFE
, 0x00, 0x20, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x00, 0x44};


/* 
 * CS8556 AV Output - Fake EDID.
 * cvbs-480p-4x3
 */
static char fake_edid_480p_4x3[] = {
  0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x59, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
, 0x00, 0x16, 0x01, 0x03, 0x80, 0x1F, 0x11, 0x78, 0x0A, 0x10, 0xB5, 0x97, 0x58, 0x57, 0x92, 0x26
, 0x1E, 0x50, 0x54, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01
, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x8C, 0x0A, 0xD0, 0x8A, 0x20, 0xE0, 0x2D, 0x10, 0x10, 0x3E
, 0x96, 0x00, 0x13, 0x8E, 0x21, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00
, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xFE, 0x00, 0x56
, 0x49, 0x41, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x00, 0x00, 0x00, 0xFE
, 0x00, 0x20, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x00, 0xB9};


/* 
 * CS8556 AV Output - Fake EDID.
 * cvbs-576i-4x3
 */
static char fake_edid_576i_4x3[] = {
  0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x59, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
, 0x00, 0x16, 0x01, 0x03, 0x80, 0x1F, 0x11, 0x78, 0x0A, 0x10, 0xB5, 0x97, 0x58, 0x57, 0x92, 0x26
, 0x1E, 0x50, 0x54, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01
, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x8C, 0x0A, 0xA0, 0x20, 0x51, 0x20, 0x18, 0x10, 0x18, 0x7E
, 0x23, 0x00, 0x13, 0x8E, 0x21, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00
, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xFE, 0x00, 0x56
, 0x49, 0x41, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x00, 0x00, 0x00, 0xFE
, 0x00, 0x20, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x00, 0x22};

/* 
 * CS8556 AV Output - Fake EDID.
 * cvbs-576p-4x3
 */
static char fake_edid_576p_4x3[] = {
  0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x59, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
, 0x00, 0x16, 0x01, 0x03, 0x80, 0x1F, 0x11, 0x78, 0x0A, 0x10, 0xB5, 0x97, 0x58, 0x57, 0x92, 0x26
, 0x1E, 0x50, 0x54, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01
, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x8C, 0x0A, 0xD0, 0x90, 0x20, 0x40, 0x31, 0x20, 0x0C, 0x40
, 0x55, 0x00, 0x13, 0x8E, 0x21, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00
, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0xFE, 0x00, 0x56
, 0x49, 0x41, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x00, 0x00, 0x00, 0xFE
, 0x00, 0x20, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x0A, 0x00, 0x82};


/*----------------------- Function Body --------------------------------------*/

union cs8556_TvEncoderParam
{
  struct
  {
    int use_pal;
    int uboot_use_source_720p;
    int kernel_use_source_720p;
    int use_progressive_edid_table;
  };
  int buf[4];
};

union cs8556_TvEncoderParam getcs8556_TvEncoderParam(void)
{
	char buf[100] = { 0 };
	int varlen = sizeof(buf);
  union cs8556_TvEncoderParam param;

  if( wmt_getsyspara("wmt.display.tvencoder.param",buf,&varlen) == 0)
  {
    DBG_DETAIL("wmt.display.tvencoder.param: %s\n", buf);
    vpp_parse_param(buf,(unsigned int *)param.buf,sizeof(union cs8556_TvEncoderParam)/sizeof(int),0);
    DBG_DETAIL("%d:%d:%d:%d\n", param.use_pal, param.uboot_use_source_720p, param.kernel_use_source_720p, param.use_progressive_edid_table);
  }
  else
  {
    DBG_DETAIL("wmt.display.tvencoder not exist, use default setting\n");
    // set default values
    param.use_pal = 1;
    param.uboot_use_source_720p = 1;
    param.kernel_use_source_720p = 0;
    param.use_progressive_edid_table = 1;
  }

  return param;
}

char* cs8556_getTable0(void)
{
  return vga_byte0;
/*
  union cs8556_TvEncoderParam param = getcs8556_TvEncoderParam();

  int use_source_720p;

#ifdef CONFIG_KERNEL
  use_source_720p = param.kernel_use_source_720p;
#else
  use_source_720p = param.uboot_use_source_720p;
#endif  

  if(param.use_pal)
  {
    if(use_source_720p)
    {
      return pal_720P_byte0;
    }
    else
    {
      return pal_byte0;
    }
  }
  else
  {
    if(use_source_720p)
    {
      return ntsc_720P_byte0;
    }
    else
    {
      return ntsc_byte0;
    }
  }
*/
}

char* cs8556_getTable1(void)
{
  return vga_byte1;
/*
  union cs8556_TvEncoderParam param = getcs8556_TvEncoderParam();

  int use_source_720p;

#ifdef CONFIG_KERNEL
  use_source_720p = param.kernel_use_source_720p;
#else
  use_source_720p = param.uboot_use_source_720p;
#endif  

  if(param.use_pal)
  {
    if(use_source_720p)
    {
      return pal_720P_byte1;
    }
    else
    {
      return pal_byte1;
    }
  }
  else
  {
    if(use_source_720p)
    {
      return ntsc_720P_byte1;
    }
    else
    {
      return ntsc_byte1;
    }
  }
*/
}

/*
char* cs8556_getEDID(void)
{
  union cs8556_TvEncoderParam param = getcs8556_TvEncoderParam();

  if(param.use_pal)
  {
    if(param.use_progressive_edid_table)
    {
      return fake_edid_576p_4x3;
    }
    else
    {
      return fake_edid_576i_4x3;
    }
  }
  else
  {
    if(param.use_progressive_edid_table)
    {
      return fake_edid_480p_4x3;
    }
    else
    {
      return fake_edid_480i_4x3;
    }
  }
}

*/

int cs8556_check_plugin(int hotplug)
{
  DBG_DETAIL("hotplug:%d\n", hotplug);

  return cs8556_isEnable();
}

// return: the read data
int cs8556_i2c_read(int addr)
{
#ifdef CONFIG_KERNEL
  return i2c_api_register_read(CS8556_ADDR, 2, addr);
#else
  uchar data = 0;
  i2c1_read(CS8556_ADDR, addr, 2, &data, 1);
  return data;
#endif
}

// return: 0 if success, otherwise failed
int cs8556_i2c_write(int addr, uchar data)
{
#ifdef CONFIG_KERNEL
  i2c_api_register_write(CS8556_ADDR, 2, addr, data);
  return 0;
#else
  return i2c1_write(CS8556_ADDR, addr, 2, &data, 1);
#endif
}


void cs8556_dumpRegs(void)
{
  int i = 0;
  int j = 0;
  int count;
  uint addr0 = 0x0000;
  uint addr1 = 0x0100;

  DBG_DETAIL("START.\n");		
  addr0 = 0x0000 ;
  addr1 = 0x0100 ;
  count = 0;
  for(i = 0 ; i < 16 && count < encoder_table_size; i++)
  {
	  printk("cs8556: %04x:", addr0);
	  for (j = 0; j < 16 && count < encoder_table_size; j++) {
		  printk(" %02x", cs8556_i2c_read(addr0));
		  addr0++;
      count++;
	  }
	  printk("\n");
  }
  DBG_DETAIL("cs8556: ===========================================\n");
  count = 0;
  for(i = 0 ; i < 16 && count < encoder_table_size; i++)
  {
	  printk("cs8556: %04x:", addr1);
	  for (j = 0; j < 16 && count < encoder_table_size; j++) {
		  printk(" %02x", cs8556_i2c_read(addr1));
		  addr1++;
      count++;
	  }
	  printk("\n");
  }
  DBG_DETAIL("END.\n");
}

int cs8556_isEnable(void)
{
  //cs8556_dumpRegs();
  return cs8556_i2c_read(0x0)?1:0;
}

void cs8556_reinitialize_table(void)
{
  int	count = 0 ;
  ulong	addr0 = 0x0000 ;
  ulong	addr1 = 0x0100 ;

  char* table0 = cs8556_getTable0();
  char* table1 = cs8556_getTable1();

  DBG_DETAIL("Start\n");
	
  DBG_DETAIL("cs8556: cs8556_i2c_write START.\n");

  for(count = 0; count < encoder_table_size; count++)
  {
	  cs8556_i2c_write(addr0++, table0[count]);
	  cs8556_i2c_write(addr1++, table1[count]);
  }

  DBG_DETAIL("cs8556: cs8556_i2c_write END.\n");

  cs8556_dumpRegs();

  DBG_DETAIL("End\n");
}

int cs8556_init(struct vout_s *vo)
{
	cs8556_not_ready = 1;

  if(cs8556_isEnable())
  {
    cs8556_reinitialize_table();

	  cs8556_not_ready = 0;

	  DPRINT("[CS8556] DVI ext device\n");
	
    return 0;
  }
  else
  {
    DPRINT("[CS8556] not exist\n");
    return -1;
  }
}

int cs8556_set_mode(unsigned int *option)
{
	vpp_datawidht_t dwidth;

	if( cs8556_not_ready )
		return -1;

	dwidth = option[1] & BIT0;
	DBG_DETAIL("cs8556_set_mode(%d)\n",(dwidth)?24:12);

	return 0;
}

void cs8556_set_power_down(int enable)
{
	if( cs8556_not_ready )
		return;

	DBG_DETAIL("cs8556_set_power_down(%d)\n",enable);

  //cs8556_reinitialize_table();
}

int cs8556_config(vout_info_t *info)
{
    DBG_DETAIL("\n");
	return 0;
}

/*
int cs8556_get_edid(char *buf)
{
  int i;    

  char* edidTable = cs8556_getEDID();

  DBG_DETAIL("%p\n", buf);

  for(i=0;i<edid_table_size;i++)
  {
      buf[i] = edidTable[i];
  }

	return 0;
}
*/

int cs8556_interrupt(void)
{
  DBG_DETAIL("\n");
	return cs8556_check_plugin(1);
}
/*----------------------- vout device plugin --------------------------------------*/
vout_dev_t cs8556_vout_dev_ops = {
	.name = "CS8556",
	.mode = VOUT_INF_DVI,

	.init = cs8556_init,
	.set_power_down = cs8556_set_power_down,
	.set_mode = cs8556_set_mode,
	.config = cs8556_config,
	.check_plugin = cs8556_check_plugin,
	//.get_edid = cs8556_get_edid,
	//.interrupt = cs8556_interrupt,
};

int cs8556_module_init(void)
{	
	vout_device_register(&cs8556_vout_dev_ops);
	return 0;
} /* End of cs8556_module_init */
module_init(cs8556_module_init);
/*--------------------End of Function Body -----------------------------------*/
#undef CS8556_C

